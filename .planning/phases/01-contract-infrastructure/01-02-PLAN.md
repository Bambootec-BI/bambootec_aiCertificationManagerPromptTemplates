---
phase: 01-contract-infrastructure
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - scripts/validate_templates.sh
  - scripts/check_versions.sh
autonomous: true

must_haves:
  truths:
    - "Running validate_templates.sh validates all 5 templates against their schemas"
    - "Running check_versions.sh detects version mismatches between templates"
    - "Scripts provide clear error messages when validation fails"
  artifacts:
    - path: "scripts/validate_templates.sh"
      provides: "Pre-commit validation workflow"
      contains: "ajv validate"
    - path: "scripts/check_versions.sh"
      provides: "Version compatibility checking"
      contains: "contract_versions"
  key_links:
    - from: "scripts/validate_templates.sh"
      to: "schemas/*.schema.json"
      via: "ajv -s flag"
      pattern: "ajv validate -s"
    - from: "scripts/check_versions.sh"
      to: "*.json templates"
      via: "jq version extraction"
      pattern: "jq.*version"
---

<objective>
Create validation scripts for pre-commit workflow and version compatibility checking.

Purpose: Enable manual validation before uploading templates to Custom GPT, catching structural errors and version drift
Output: 2 executable bash scripts in scripts/ directory
</objective>

<execution_context>
@/Users/bambootec/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bambootec/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-contract-infrastructure/01-RESEARCH.md
@.planning/phases/01-contract-infrastructure/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create template validation script</name>
  <files>scripts/validate_templates.sh</files>
  <action>
Create scripts/validate_templates.sh that:

1. Creates scripts/ directory if it doesn't exist
2. Checks if ajv-cli is installed, provides install instructions if not
3. Defines template-to-schema mapping:
   - skill_tree_builder_template.json -> skill_tree_builder.schema.json
   - skill_tree_to_content_tree_template.json -> skill_tree_to_content.schema.json
   - skill_to_practice_exercises_template.json -> skill_to_practice_exercises.schema.json
   - skill_to_evaluation_exam_template.json -> skill_to_evaluation_exam.schema.json
   - custom_gpt_instructions.json -> custom_gpt_instructions.schema.json
4. For each template:
   - Run: ajv validate -s schemas/$schema -d $template -r "schemas/shared/*.schema.json"
   - Track success/failure
5. Exit with 0 if all pass, 1 if any fail
6. Provide summary of results

Script must be executable (chmod +x) and include:
- Shebang: #!/bin/bash
- Clear output messages
- Color coding if terminal supports it (green for pass, red for fail)
  </action>
  <verify>
```bash
chmod +x scripts/validate_templates.sh
head -20 scripts/validate_templates.sh  # Check structure
```
  </verify>
  <done>
validate_templates.sh exists, is executable, and contains ajv validate commands for all 5 templates with -r flag for shared schemas.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create version compatibility checking script</name>
  <files>scripts/check_versions.sh</files>
  <action>
Create scripts/check_versions.sh that:

1. Uses jq to extract version info from each template
2. Defines the expected version chain:
   - skill_tree_builder produces skill_tree
   - skill_tree_to_content expects skill_tree, produces content_tree + content_summary
   - skill_to_practice_exercises expects content_summary, produces exercise_tree + exercise_summary
   - skill_to_evaluation_exam expects content_summary + exercise_summary
3. For each template pair:
   - Extract producer version from upstream template's meta.version or contract_versions.output_produces
   - Extract expected version from downstream template's contract_versions.input_expects
   - Compare and warn if mismatch
4. Output a compatibility matrix showing:
   - Template -> Version -> Downstream expects
5. Exit with 0 if all compatible, 1 if any mismatch

Note: Templates may not have contract_versions yet (added in Plan 03). Script should handle missing fields gracefully and report "not yet configured" for templates without version markers.
  </action>
  <verify>
```bash
chmod +x scripts/check_versions.sh
head -30 scripts/check_versions.sh  # Check structure
```
  </verify>
  <done>
check_versions.sh exists, is executable, extracts version info with jq, handles missing contract_versions gracefully, and outputs compatibility status.
  </done>
</task>

</tasks>

<verification>
1. Both scripts exist in scripts/ directory
2. Both scripts are executable (chmod +x)
3. validate_templates.sh contains ajv validate commands
4. check_versions.sh uses jq for version extraction
5. Both scripts have proper error handling
</verification>

<success_criteria>
- scripts/validate_templates.sh runs ajv validate for all 5 templates
- scripts/check_versions.sh checks version compatibility across template chain
- Scripts provide clear, actionable output
- Scripts exit with appropriate codes (0 for success, 1 for failure)
</success_criteria>

<output>
After completion, create `.planning/phases/01-contract-infrastructure/01-02-SUMMARY.md`
</output>
